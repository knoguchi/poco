language: cpp

cache:
 - apt

services:
  - mongodb
  - redis
  - postgresql
  - mysql

addons:
  postgresql: "9.4"

git:
  submodules: false

jobs:
  include:
    - name: Android (API level 19)
      language: android
      os: linux
      dist: trusty
      android:
        components:
          - tools
          - platform-tools
      install:
        - echo y | sdkmanager "cmake;3.10.2.4988404"
        - echo $PATH
        - which cmake
        - android list targets
      before_script:
        - echo no | android create avd --force -n test -t android-24 --abi armeabi-v7a -c 100M
        - emulator -avd test -no-audio -no-window &
        - android-wait-for-emulator
        - adb shell input keyevent 82 &
      script:
        - export SAMPLE_CI_RESULT=0
        - source .ci_tools/setup_env.sh
        - cmake -H. -Bcmake-build -GNinja -DANDROID_ABI=armeabi-v7a -DCMAKE_BUILD_TYPE=Release ninja -DANDROID_STL="c++_static" -DANDROID_CPP_FEATURES="exceptions rtti" -DENABLE_APACHECONNECTOR=OFF -DENABLE_NETSSL=ON -DENABLE_CRYPTO=OFF -DENABLE_JWT=OFF -DENABLE_DATA_MYSQL=OFF -DENABLE_DATA_POSTGRESQL=OFF -DENABLE_TESTS=ON -DENABLE_LONG_RUNNING_TESTS=OFF -DOLD_REDIS_VERSION=ON 
        - cmake --build cmake-build --target all
